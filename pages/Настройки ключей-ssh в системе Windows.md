
# Настройка OpenSSH в Windows 11

* [Microsoft Learn. "Руководство по SSH в Терминал Windows"](https://learn.microsoft.com/ru-ru/windows/terminal/tutorials/ssh)
* [Microsoft Learn. "Начало работы с OpenSSH для Windows"](https://learn.microsoft.com/ru-ru/windows-server/administration/openssh/openssh_install_firstuse)
           
---

В Windows 11 присутствует встроенный *сервер и клиент SSH*, основанный на OpenSSH. По умолчанию клиент OpenSSH уже установлен и находятся в каталоге: `C:\Windows\System32\OpenSSH`.
Также можно это увидеть через "Параметры"(<kbd>Win</kbd> + <kbd>i</kbd>) -> "Система" -> "Дополнительные компоненты"; и там же в 
"Дополнительные компоненты" -> "Добавление дополнительного компонента", можно установить сервер OpenSSH.

## Настройки ключей-ssh в системе Windows 11

Ключи-ssh в Windows 11, лежат в каталоге `C:\Users\You_user\.ssh\`

### Если у вас уже есть ключи-ssh
        
Если у вас уже есть ключи, тогда просто поместите их в каталог `C:\Users\You_user\.ssh\`. Если каталога нет, просто создайте его обычным образом.
            
### Создаём новый ключ-ssh в Windows 11

Команда создаст пару-ключей и поместит их в домашней директории: `C:\Users\You_user\.ssh\`:
```PS
ssh-keygen -t ed25519
```

---

### Включаем службу ssh-agent и настраиваем её на автоматический запуск

По умолчанию служба ssh-agent отключена.  
**Внимание**: Чтобы включить службу, нужны права администратора. Убедитесь, что вы работаете как администратор.

* Включаем автоматический запуск:  
```PS
Get-Service ssh-agent | Set-Service -StartupType Automatic
```

* Запускаем службу:
```PS
Start-Service ssh-agent
```

* Проверим что служба запустилась
```PS
Get-Service ssh-agent
```

---

### Добавляем ключ в ssh-agent

**Внимание**: Если у вас запущен терминал от имени администратора, закройте его. Администратор тут не нужен, после того как служба
ssh-agent запущена, любой пользователь на хосте может добавлять туда свои ключи.

* загрузим файл ключа в ssh-agent (нужно указать путь до ключа):
```
ssh-add $env:USERPROFILE\.ssh\id_ed25519
```

Закрытый ключ нельзя получить из агента, если использовался надежный алгоритм, например Ed25519.

Сразу копируем пару ключей на флешку, и после того как закрытый ключ добавлен в ssh-agent, удаляем его с локального диска.

Если вы утратите доступ к закрытому ключу, вам нужно будет создать новую пару ключей и обновить открытый ключ во всех системах, с которыми вы работаете.

---

### Дополнително

Добавляем открытый ключ на удаленный сервер к которому будем коннектиться по ssh, в файл `~/.ssh/authorized_keys`
